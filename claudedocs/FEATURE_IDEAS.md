# 機能追加アイデア

## ユーザー提案

| 機能 | 概要 | 必要なもの | 優先度 |
|------|------|-----------|--------|
| **マイページ充実** | ダッシュボード的なもの（今は空っぽ） | 表示コンテンツの設計 | 高 |
| **スコアリング** | 複数指標を総合評価して点数化 | 評価基準の設計 | 高 |
| **お気に入り登録** | ユーザー別の銘柄保存 | ログイン機能（既存あり） | 高 |

---

## 追加提案

### 投資判断サポート系

| 機能 | 概要 | 難易度 | 備考 |
|------|------|--------|------|
| **銘柄比較** | 2〜4銘柄を横並びで比較表示 | 低 | UIの追加だけで実現可能 |
| **銘柄メモ** | 銘柄ごとに投資判断メモを残せる | 低 | テーブル追加のみ |
| **アラート設定** | 株価や指標が閾値超えたら通知 | 中 | バックグラウンドジョブ必要 |
| **配当カレンダー** | 登録銘柄の配当予定日一覧 | 中 | yfinanceから取得可能 |

### ポートフォリオ系

| 機能 | 概要 | 難易度 | 備考 |
|------|------|--------|------|
| **保有銘柄管理** | 購入価格・株数を登録して損益計算 | 中 | 新規テーブル設計必要 |
| **セクター配分** | ポートフォリオの業種分散を可視化 | 中 | Chart.jsで円グラフ |
| **配当収入予測** | 年間配当収入の見込み計算 | 低 | 既存データで計算可能 |

### 分析強化系

| 機能 | 概要 | 難易度 | 備考 |
|------|------|--------|------|
| **業種平均比較** | 同業他社との指標比較 | 中 | 業種別の集計処理必要 |
| **成長率ランキング** | 売上・利益成長率でランク表示 | 低 | 既存データでソート |
| **割安度判定** | PER/PBR/配当利回りで割安銘柄抽出 | 低 | フィルター追加のみ |

### 出力系

| 機能 | 概要 | 難易度 | 備考 |
|------|------|--------|------|
| **PDF/Excelレポート** | 分析結果をファイル出力 | 中 | reportlab / openpyxl |
| **共有リンク** | 分析結果を他の人に共有 | 中 | 公開URL生成機能 |

---

## 優先度の提案

### Phase 1（すぐ実装可能・効果高い）

1. **スコアリング機能**
   - 既存データで計算するだけ
   - 評価基準例：
     - 自己資本比率 40%以上 → +20点
     - 営業利益率 10%以上 → +20点
     - ROE 12%以上 → +20点
     - 3年連続増収 → +20点
     - 配当利回り 3%以上 → +10点
     - PER 15倍以下 → +10点

2. **銘柄比較**
   - UIの追加だけで実現可能
   - ウォッチリストから複数選択 → 比較画面表示

3. **マイページ充実**
   - ウォッチリスト概要（登録数、スコア上位3銘柄）
   - 配当予定カレンダー（直近の配当）
   - 最近分析した銘柄

### Phase 2（中期的に実装）

4. **銘柄メモ機能**
   - screened_latestテーブルに`memo`カラム追加
   - 投資判断の理由を記録

5. **保有銘柄管理**
   - 新規テーブル: `holdings`
     - company_code, shares, purchase_price, purchase_date
   - 損益計算表示

6. **配当カレンダー**
   - yfinanceから配当予定日取得
   - カレンダー形式で表示

### Phase 3（将来的に検討）

7. **アラート機能**
8. **PDF/Excelレポート出力**
9. **業種平均比較**

---

## 合致度基準（yomu.md準拠）

### 総合合致度（100点満点）

10項目 × 10点 = 100点満点。各条件を満たせば10点加算。

| # | 指標 | 条件 | 配点 |
|---|------|------|------|
| 1 | 時価総額 | <= 700億円 | 10点 |
| 2 | 自己資本比率 | >= 30% | 10点 |
| 3 | 売上高増減率(2期前→前期) | > 0% | 10点 |
| 4 | 売上高営業利益率 | >= 10% | 10点 |
| 5 | 営業利益増減率(2期前→前期) | > 0% | 10点 |
| 6 | 営業CF前期 | > 0億円 | 10点 |
| 7 | フリーCF前期 | > 0億円 | 10点 |
| 8 | ROA(前期) | > 4.5% | 10点 |
| 9 | PER(来期) | < 40倍 | 10点 |
| 10 | PBR | < 10倍 | 10点 |

### 未実装の条件（データ取得困難）

| 指標 | 理由 |
|------|------|
| TK会社乖離(売上高/営業利益) | データソースなし |
| 売上高増減率(前期→今期予) | 予想データ取得が必要 |
| 売上高増減率(今期予→来期予) | 予想データ取得が必要 |
| 営業利益増減率(前期→今期予) | 予想データ取得が必要 |
| 営業利益増減率(今期予→来期予) | 予想データ取得が必要 |
| 上場年月 | 取得処理の追加が必要 |

### 合致度ランク

| ランク | 合致度 | 評価 |
|--------|--------|------|
| S | 80〜100 | 非常に優良 |
| A | 60〜79 | 優良 |
| B | 40〜59 | 標準 |
| C | 20〜39 | 要注意 |
| D | 0〜19 | 条件未達 |

---

## 必要なDB変更

### screened_latest テーブル追加カラム
```sql
ALTER TABLE screened_latest ADD COLUMN memo TEXT;
ALTER TABLE screened_latest ADD COLUMN score INTEGER;
ALTER TABLE screened_latest ADD COLUMN score_rank VARCHAR(1);
```

### 新規テーブル: holdings（保有銘柄）
```sql
CREATE TABLE holdings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    company_code VARCHAR(20) NOT NULL,
    shares INTEGER NOT NULL,
    purchase_price DECIMAL(10,2),
    purchase_date DATE,
    memo TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 新規テーブル: favorites（お気に入り）
```sql
CREATE TABLE favorites (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    company_code VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, company_code)
);
```
