# 企業情報抽出アプリ - 機能一覧

## 概要

Flask + Supabaseで構築された企業財務分析・管理システム。
Yahoo Finance APIを活用した株式データ取得と、Dify AIを活用した事業計画書作成支援機能を提供。

---

## 主要機能

### 1. 管理画面（Admin）`/admin`

株式分析とウォッチリスト管理のメイン画面。

#### 株式分析機能
- **銘柄コード入力** → Yahoo Financeからリアルタイムデータ取得
- **対応銘柄**: 日本株（例: `7203.T`）、米国株（例: `AAPL`）
- **取得データ**:
  - 基本情報（会社名、業種、時価総額、株価）
  - 財務指標（PER、PBR、配当利回り、自己資本比率、営業利益率）
  - 財務履歴（売上高、営業利益、経常利益、純利益）- 過去5年分
  - キャッシュフロー（営業CF、投資CF、財務CF）
  - 配当情報（EPS、DPS、配当性向）
  - 株主・役員情報（大株主、機関投資家、役員一覧）
  - 事業概要
  - 株価チャート（期間選択可能: 1日〜5年）

#### ウォッチリスト機能
- **銘柄登録**: 分析した銘柄をデータベースに保存
- **一覧表示**: 登録銘柄の主要指標を一覧表示
- **データ編集**: 指標値を手動で編集・保存可能
- **データ更新**: Yahoo Financeから最新データで上書き
- **一括登録**: 複数銘柄をまとめて登録

---

### 2. 好調企業スクリーナー（Screener）`/screener`

財務基準に基づいて選定された投資価値の高い企業一覧。

#### 選定基準
- FCF利回り 5%以上 かつ EV/EBITDA 10倍以下
- 売上・営業利益が3年連続成長
- 自己資本比率 30%以上
- 営業利益率 10%以上
- ROE 12%以上

#### フィルター機能
- 業種別フィルタリング
- 時価総額範囲指定
- ソート機能（各指標での並び替え）

---

### 3. 財務分析（Financial Analysis）`/financial_analysis`

自社の決算データに基づく詳細な財務分析機能。

#### 分析指標
- **売上増加率**: 前期比での売上成長率
- **営業利益率**: 売上に対する営業利益の割合
- **労働生産性**: 従業員1人あたりの付加価値
- **EBITDA有利子負債倍率**: 債務返済能力の指標
- **営業運転資本回転期間**: 運転資金効率
- **自己資本比率**: 財務健全性の指標

#### 業種別基準値比較
- Excelファイル（`tools/基準値.xlsx`）に基づく業種・事業規模別の中央値と比較
- 4段階評価（Ⅰ〜Ⅳ）でのランク付け

---

### 4. 事業計画書作成（Business Plan Preparation）`/business_plan_preparation`

Dify AIを活用した事業計画書の自動生成支援。

#### 入力項目
- 事業の説明
- 現在の売上状況
- 主な顧客層
- 販促方法
- 顧客ニーズ
- 市場動向
- 将来予測
- 会社の強み
- 経営方針・目標
- 将来の計画
- 補助金プロジェクト概要
- 期待される効果

#### 機能
- AIによるテキスト拡張（入力内容を2倍に充実化）
- 並列処理による高速生成
- 対話形式での内容ブラッシュアップ

---

### 5. チャットボット（Chatbot）`/chatbot`

Dify AIを活用した対話型アシスタント。

- 会話履歴の保存・表示
- コンテキストを考慮した応答生成
- ユーザー別の会話管理

---

### 6. 決算情報設定（Settlements）`/settlements`

自社の決算データを登録・管理。

#### 登録可能データ
- 売上高
- 営業利益
- 経常利益
- 純利益
- 総資産
- 純資産
- 有利子負債
- 従業員数
- その他財務項目

---

### 7. ユーザー管理（User）`/user`

システム管理者向けのユーザー・顧客管理機能。

- 顧客情報の登録・編集・削除
- 決算データの紐付け
- 自動保存機能

---

### 8. マイページ（MyPage）`/mypage`

ログインユーザー向けのダッシュボード。

---

### 9. コミュニティ（Community）`/community`

ユーザー間の情報共有・交流機能。

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| バックエンド | Python / Flask |
| データベース | Supabase (PostgreSQL) |
| フロントエンド | HTML / Tailwind CSS / Alpine.js |
| 株式データ | yfinance / yahooquery |
| AI連携 | Dify API |
| チャート | Chart.js / Matplotlib |
| 認証 | Flask-Login |

---

## API エンドポイント

### ウォッチリスト関連
| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| GET | `/api/watchlist` | 登録銘柄一覧取得 |
| POST | `/api/watchlist/add` | 銘柄登録 |
| DELETE | `/api/watchlist/remove/<code>` | 銘柄削除 |
| GET | `/api/watchlist/check/<code>` | 登録状態確認 |
| POST | `/api/watchlist/update` | データ更新（編集保存） |

### 株式分析関連
| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| POST | `/api/stock/analyze` | 銘柄分析実行 |
| POST | `/api/stock/batch` | 複数銘柄一括分析 |
| GET | `/api/stock/cache/<symbol>` | キャッシュデータ取得 |

---

## データベーステーブル

### Supabase
- `watched_tickers` - ウォッチリスト
- `screened_latest` - スクリーニング済み銘柄データ

### SQLAlchemy (Flask)
- `User` - ユーザー情報
- `Settlement` - 決算データ
- `Message` - チャット履歴

---

## 環境変数

```env
SUPABASE_URL=<Supabase URL>
SUPABASE_SERVICE_ROLE_KEY=<Supabase Key>
DIFY_API_KEY=<Dify API Key>
BASE_URL=<Dify Base URL>
```

---

## 起動方法

```bash
# 依存パッケージインストール
pip install -r requirements.txt

# 開発サーバー起動
python app.py

# ブラウザでアクセス
http://localhost:5000
```
