{% extends "layout.html" %}

{% block title %}„Éû„Ç§„Éö„Éº„Ç∏ - Company Note{% endblock %}

{% block content %}
<style>
    .mypage {
        font-family: 'Inter', 'Noto Sans JP', -apple-system, sans-serif;
    }
    .mypage-hero {
        background: #fafaf8;
        border-bottom: 1px solid #e8e8e4;
    }
    .mp-card {
        background: #fff;
        border: 1px solid #ebebeb;
        border-radius: 12px;
        transition: all 0.2s ease;
    }
    .mp-card:hover {
        border-color: #d4d4d4;
        box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    .note-card {
        background: #fff;
        border: 1px solid #ebebeb;
        border-radius: 10px;
        border-left: 3px solid #1b4332;
        padding: 12px 14px;
        transition: all 0.2s ease;
        cursor: pointer;
        text-decoration: none;
        display: block;
        color: inherit;
    }
    .note-card:hover {
        border-color: #d4d4d4;
        border-left-color: #1b4332;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .section-head {
        font-size: 13px;
        font-weight: 700;
        color: #1a1a1a;
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 12px;
    }
    .section-head i { color: #2d6a4f; font-size: 12px; }
    .tag {
        display: inline-block;
        padding: 1px 7px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 500;
        background: #f0fdf4;
        color: #15803d;
        cursor: pointer;
        transition: all 0.15s;
    }
    .tag:hover { background: #dcfce7; }
    .tag.active { background: #1b4332; color: #fff; }
    .btn-sm-green {
        background: #1b4332; color: #fff; border: none;
        border-radius: 6px; padding: 5px 12px;
        font-size: 12px; font-weight: 500; cursor: pointer;
        transition: background 0.2s;
    }
    .btn-sm-green:hover { background: #2d6a4f; }
    .btn-sm-outline {
        background: transparent; color: #2d6a4f;
        border: 1px solid #d4d4d4; border-radius: 6px;
        padding: 5px 12px; font-size: 12px; font-weight: 500;
        cursor: pointer; transition: all 0.2s;
    }
    .btn-sm-outline:hover { border-color: #2d6a4f; background: #f0fdf4; }
    .star { color: #eab308; font-size: 11px; }
    .star-empty { color: #d4d4d4; font-size: 11px; }
    .company-chip {
        display: flex; align-items: center; gap: 8px;
        padding: 8px 10px; border-radius: 8px;
        border: 1px solid #ebebeb; background: #fff;
        transition: all 0.15s;
        text-decoration: none; color: inherit;
        position: relative;
    }
    .company-chip:hover { border-color: #2d6a4f; box-shadow: 0 1px 4px rgba(0,0,0,0.04); }
    .status-badge {
        font-size: 9px; font-weight: 600;
        padding: 1px 5px; border-radius: 3px;
        line-height: 1.4;
    }
    .status-noted { background: #f0fdf4; color: #15803d; }
    .status-pending { background: #fef9c3; color: #a16207; }
    .setting-row {
        display: flex; align-items: center; justify-content: space-between;
        padding: 8px 10px; border-radius: 8px;
        text-decoration: none;
        transition: background 0.15s;
    }
    .setting-row:hover { background: #fafaf8; }
    .sort-btn {
        font-size: 11px; padding: 3px 8px; border-radius: 5px;
        border: 1px solid #ebebeb; background: #fff; color: #525252;
        cursor: pointer; transition: all 0.15s;
    }
    .sort-btn:hover, .sort-btn.active { border-color: #2d6a4f; color: #1b4332; background: #f0fdf4; }
    .recent-item {
        display: flex; align-items: center; gap: 8px;
        padding: 6px 8px; border-radius: 6px;
        transition: background 0.15s;
        text-decoration: none; color: inherit;
    }
    .recent-item:hover { background: #f8faf8; }
    .empty-state {
        text-align: center; padding: 24px 16px;
    }
    .empty-state i { font-size: 28px; color: #d4d4d4; margin-bottom: 8px; }
    .empty-state p { font-size: 12px; color: #a3a3a3; margin-bottom: 10px; }
</style>

<div class="mypage min-h-screen" style="background: #f7f7f5;" x-data="mypageApp()">

    <!-- „Éò„ÉÉ„ÉÄ„ÉºÔºà„Ç≥„É≥„Éë„ÇØ„ÉàÔºâ -->
    <div class="mypage-hero">
        <div class="max-w-7xl mx-auto px-6 py-5">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <!-- Â∑¶: „Éó„É≠„Éï„Ç£„Éº„É´ -->
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0 w-11 h-11 rounded-full flex items-center justify-center text-sm font-bold text-white" style="background: #1b4332;">Áî∞</div>
                    <div>
                        <p class="text-xs font-semibold tracking-widest uppercase" style="color: #16a34a;">My Page</p>
                        <h1 class="text-lg font-bold leading-tight" style="color: #1a1a1a;">Áî∞‰∏≠ Â§™ÈÉé</h1>
                    </div>
                </div>
                <!-- Âè≥: Â≠¶Áøí„Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-1.5 px-3 py-1.5 rounded-full" style="background:#f0fdf4; border:1px solid #dcfce7;">
                        <i class="fas fa-fire" style="color:#f97316; font-size:12px;"></i>
                        <span class="text-xs font-bold" style="color:#1b4332;">7Êó•ÈÄ£Á∂ö</span>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold" style="color:#1b4332;">23</div>
                        <div class="text-xs" style="color:#737373;">Â≠¶ÁøíÊó•Êï∞</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊú¨‰Ωì -->
    <div class="max-w-7xl mx-auto px-6 py-5">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-5">

            <!-- ===== Â∑¶„Ç´„É©„É†: Á†îÁ©∂ÂØæË±°‰ºÅÊ•≠ + ÊúÄËøëË¶ã„Åü‰ºÅÊ•≠ ===== -->
            <div class="lg:col-span-4 xl:col-span-3 space-y-5">
                <!-- Á†îÁ©∂ÂØæË±°‰ºÅÊ•≠ -->
                <div class="mp-card p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="section-head mb-0"><i class="fas fa-building"></i>Á†îÁ©∂ÂØæË±°‰ºÅÊ•≠</h2>
                        <button class="btn-sm-outline"><i class="fas fa-plus mr-1" style="font-size:10px;"></i>ËøΩÂä†</button>
                    </div>
                    <div class="grid grid-cols-1 gap-2">
                        <a href="/stock/6861" class="company-chip">
                            <div class="w-7 h-7 rounded-md flex items-center justify-center flex-shrink-0" style="background:#f0fdf4;">
                                <i class="fas fa-industry" style="color:#15803d; font-size:11px;"></i>
                            </div>
                            <div style="min-width:0; flex:1;">
                                <p class="text-xs font-bold truncate" style="color:#1a1a1a;">„Ç≠„Éº„Ç®„É≥„Çπ</p>
                                <p class="text-xs truncate" style="color:#a3a3a3;">6861</p>
                            </div>
                            <span class="status-badge status-noted">„Éé„Éº„ÉàÊ∏à</span>
                        </a>
                        <a href="/stock/7974" class="company-chip">
                            <div class="w-7 h-7 rounded-md flex items-center justify-center flex-shrink-0" style="background:#fef2f8;">
                                <i class="fas fa-gamepad" style="color:#db2777; font-size:11px;"></i>
                            </div>
                            <div style="min-width:0; flex:1;">
                                <p class="text-xs font-bold truncate" style="color:#1a1a1a;">‰ªªÂ§©Â†Ç</p>
                                <p class="text-xs truncate" style="color:#a3a3a3;">7974</p>
                            </div>
                            <span class="status-badge status-noted">„Éé„Éº„ÉàÊ∏à</span>
                        </a>
                        <a href="/stock/4063" class="company-chip">
                            <div class="w-7 h-7 rounded-md flex items-center justify-center flex-shrink-0" style="background:#eff6ff;">
                                <i class="fas fa-flask" style="color:#2563eb; font-size:11px;"></i>
                            </div>
                            <div style="min-width:0; flex:1;">
                                <p class="text-xs font-bold truncate" style="color:#1a1a1a;">‰ø°Ë∂äÂåñÂ≠¶</p>
                                <p class="text-xs truncate" style="color:#a3a3a3;">4063</p>
                            </div>
                            <span class="status-badge status-noted">„Éé„Éº„ÉàÊ∏à</span>
                        </a>
                        <a href="/stock/7203" class="company-chip">
                            <div class="w-7 h-7 rounded-md flex items-center justify-center flex-shrink-0" style="background:#fefce8;">
                                <i class="fas fa-car" style="color:#ca8a04; font-size:11px;"></i>
                            </div>
                            <div style="min-width:0; flex:1;">
                                <p class="text-xs font-bold truncate" style="color:#1a1a1a;">„Éà„É®„Çø</p>
                                <p class="text-xs truncate" style="color:#a3a3a3;">7203</p>
                            </div>
                            <span class="status-badge status-pending">Êú™ÂàÜÊûê</span>
                        </a>
                    </div>
                </div>

                <!-- ÊúÄËøëË¶ã„Åü‰ºÅÊ•≠ -->
                <div class="mp-card p-4">
                    <h2 class="section-head"><i class="fas fa-history"></i>ÊúÄËøëË¶ã„Åü‰ºÅÊ•≠</h2>
                    <div class="space-y-0.5">
                        <a href="/stock/6758" class="recent-item">
                            <div class="w-5 h-5 rounded flex items-center justify-center flex-shrink-0" style="background:#f0fdf4;">
                                <i class="fas fa-music" style="color:#15803d; font-size:8px;"></i>
                            </div>
                            <span class="text-xs font-medium flex-1" style="color:#1a1a1a;">„ÇΩ„Éã„ÉºG</span>
                            <span class="text-xs" style="color:#a3a3a3;">3ÊôÇÈñìÂâç</span>
                        </a>
                        <a href="/stock/9984" class="recent-item">
                            <div class="w-5 h-5 rounded flex items-center justify-center flex-shrink-0" style="background:#eff6ff;">
                                <i class="fas fa-globe" style="color:#2563eb; font-size:8px;"></i>
                            </div>
                            <span class="text-xs font-medium flex-1" style="color:#1a1a1a;">„ÇΩ„Éï„Éà„Éê„É≥„ÇØG</span>
                            <span class="text-xs" style="color:#a3a3a3;">Êò®Êó•</span>
                        </a>
                        <a href="/stock/6501" class="recent-item">
                            <div class="w-5 h-5 rounded flex items-center justify-center flex-shrink-0" style="background:#fef2f8;">
                                <i class="fas fa-bolt" style="color:#db2777; font-size:8px;"></i>
                            </div>
                            <span class="text-xs font-medium flex-1" style="color:#1a1a1a;">Êó•Á´ãË£Ω‰ΩúÊâÄ</span>
                            <span class="text-xs" style="color:#a3a3a3;">2Êó•Ââç</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- ===== ‰∏≠Â§Æ„Ç´„É©„É†: „Éû„Ç§„Éé„Éº„Éà ===== -->
            <div class="lg:col-span-5 xl:col-span-6">
                <div class="mp-card p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="section-head mb-0"><i class="fas fa-book"></i>„Éû„Ç§„Éé„Éº„Éà</h2>
                        <button class="btn-sm-green"><i class="fas fa-plus mr-1" style="font-size:10px;"></i>‰ΩúÊàê</button>
                    </div>

                    <!-- „ÇΩ„Éº„ÉàÔºÜ„Éï„Ç£„É´„Çø -->
                    <div class="mb-3 flex items-center gap-2 flex-wrap">
                        <!-- Ê§úÁ¥¢ -->
                        <div style="position:relative; flex:1; min-width:120px;">
                            <i class="fas fa-search" style="position:absolute; left:10px; top:50%; transform:translateY(-50%); color:#a3a3a3; font-size:12px;"></i>
                            <input type="text" placeholder="„Éé„Éº„Éà„ÇíÊ§úÁ¥¢..." x-model="noteSearch" style="width:100%; padding:7px 10px 7px 32px; border:1px solid #ebebeb; border-radius:7px; font-size:12px; color:#1a1a1a; background:#fff; outline:none;" onfocus="this.style.borderColor='#2d6a4f'" onblur="this.style.borderColor='#ebebeb'">
                        </div>
                        <!-- „ÇΩ„Éº„Éà„Éú„Çø„É≥ -->
                        <div class="flex items-center gap-1">
                            <button class="sort-btn" :class="{ 'active': noteSort === 'date' }" @click="noteSort = 'date'">
                                <i class="fas fa-clock mr-0.5" style="font-size:9px;"></i>Êñ∞„Åó„ÅÑÈ†Ü
                            </button>
                            <button class="sort-btn" :class="{ 'active': noteSort === 'star' }" @click="noteSort = 'star'">
                                <i class="fas fa-star mr-0.5" style="font-size:9px;"></i>Ë©ï‰æ°È†Ü
                            </button>
                        </div>
                    </div>

                    <!-- „Çø„Ç∞„Éï„Ç£„É´„Çø -->
                    <div class="mb-3 flex items-center gap-1.5 flex-wrap">
                        <span class="text-xs" style="color:#a3a3a3; margin-right:2px;">„Çø„Ç∞:</span>
                        <template x-for="tag in allTags" :key="tag">
                            <span class="tag" :class="{ 'active': activeTag === tag }" @click="activeTag = activeTag === tag ? '' : tag" x-text="tag"></span>
                        </template>
                    </div>

                    <!-- „Éé„Éº„Éà‰∏ÄË¶ß -->
                    <div class="space-y-2">
                        <template x-for="note in filteredNotes" :key="note.code">
                            <a :href="'/stock/' + note.code" class="note-card">
                                <div class="flex items-start justify-between mb-1">
                                    <div>
                                        <span class="text-sm font-bold" style="color:#1a1a1a;" x-text="note.name"></span>
                                        <span class="text-xs ml-1.5" style="color:#a3a3a3;" x-text="note.code"></span>
                                    </div>
                                    <span>
                                        <template x-for="i in 5" :key="i">
                                            <span :class="i <= note.stars ? 'star' : 'star-empty'">‚òÖ</span>
                                        </template>
                                    </span>
                                </div>
                                <p class="text-xs leading-relaxed mb-1.5" style="color:#525252;" x-text="note.summary"></p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-1.5">
                                        <template x-for="t in note.tags" :key="t">
                                            <span class="tag" x-text="t" style="cursor:default;"></span>
                                        </template>
                                    </div>
                                    <span class="text-xs" style="color:#a3a3a3;" x-text="note.date"></span>
                                </div>
                            </a>
                        </template>

                        <!-- Á©∫Áä∂ÊÖã -->
                        <div x-show="filteredNotes.length === 0" class="empty-state">
                            <div><i class="fas fa-book-open"></i></div>
                            <p x-show="noteSearch || activeTag">Êù°‰ª∂„Å´‰∏ÄËá¥„Åô„Çã„Éé„Éº„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</p>
                            <p x-show="!noteSearch && !activeTag">„Åæ„Å†„Éé„Éº„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                            <button x-show="noteSearch || activeTag" class="btn-sm-outline" @click="noteSearch = ''; activeTag = ''">„Éï„Ç£„É´„Çø„Çí„É™„Çª„ÉÉ„Éà</button>
                            <button x-show="!noteSearch && !activeTag" class="btn-sm-green">
                                <i class="fas fa-plus mr-1" style="font-size:10px;"></i>ÊúÄÂàù„ÅÆ„Éé„Éº„Éà„Çí‰ΩúÊàê
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== Âè≥„Ç´„É©„É† ===== -->
            <div class="lg:col-span-3 space-y-5">
                <!-- Ë®≠ÂÆö -->
                <div class="mp-card p-4">
                    <h2 class="section-head"><i class="fas fa-cog"></i>Ë®≠ÂÆö</h2>
                    <div class="space-y-1">
                        <a href="/change_password" class="setting-row" style="text-decoration:none;">
                            <div class="flex items-center gap-2.5">
                                <i class="fas fa-key" style="color:#525252; font-size:11px;"></i>
                                <span class="text-xs font-medium" style="color:#1a1a1a;">„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥</span>
                            </div>
                            <i class="fas fa-chevron-right" style="color:#d4d4d4; font-size:10px;"></i>
                        </a>
                        <div class="setting-row" style="opacity:0.45;">
                            <div class="flex items-center gap-2.5">
                                <i class="fas fa-bell" style="color:#525252; font-size:11px;"></i>
                                <span class="text-xs font-medium" style="color:#1a1a1a;">ÈÄöÁü•Ë®≠ÂÆö</span>
                            </div>
                            <span class="text-xs" style="color:#a3a3a3;">Ê∫ñÂÇô‰∏≠</span>
                        </div>
                        <div class="setting-row" style="opacity:0.45;">
                            <div class="flex items-center gap-2.5">
                                <i class="fas fa-palette" style="color:#525252; font-size:11px;"></i>
                                <span class="text-xs font-medium" style="color:#1a1a1a;">Ë°®Á§∫Ë®≠ÂÆö</span>
                            </div>
                            <span class="text-xs" style="color:#a3a3a3;">Ê∫ñÂÇô‰∏≠</span>
                        </div>
                        <div class="setting-row" style="opacity:0.45;">
                            <div class="flex items-center gap-2.5">
                                <i class="fas fa-download" style="color:#525252; font-size:11px;"></i>
                                <span class="text-xs font-medium" style="color:#1a1a1a;">„Ç®„ÇØ„Çπ„Éù„Éº„Éà</span>
                            </div>
                            <span class="text-xs" style="color:#a3a3a3;">Ê∫ñÂÇô‰∏≠</span>
                        </div>
                    </div>
                    <!-- Â≠¶Áøí„ÅÆË®òÈå≤ -->
                    <div style="border-top: 1px solid #ebebeb; margin-top: 12px; padding-top: 12px;">
                        <p class="text-xs font-bold mb-2.5" style="color:#525252; letter-spacing:0.02em;"><i class="fas fa-seedling mr-1" style="color:#2d6a4f; font-size:11px;"></i>Â≠¶Áøí„ÅÆË®òÈå≤</p>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="text-center p-2 rounded-lg" style="background:#f8faf8;">
                                <div class="text-base mb-0.5">üè¢</div>
                                <div class="text-sm font-bold" style="color:#1b4332;">12Á§æ</div>
                                <div class="text-xs" style="color:#737373;">Á†îÁ©∂„Åó„Åü‰ºÅÊ•≠</div>
                            </div>
                            <div class="text-center p-2 rounded-lg" style="background:#f8faf8;">
                                <div class="text-base mb-0.5">üìù</div>
                                <div class="text-sm font-bold" style="color:#1b4332;">8‰ª∂</div>
                                <div class="text-xs" style="color:#737373;">Êõ∏„ÅÑ„Åü„Éé„Éº„Éà</div>
                            </div>
                            <div class="text-center p-2 rounded-lg" style="background:#f8faf8;">
                                <div class="text-base mb-0.5">üìñ</div>
                                <div class="text-sm font-bold" style="color:#1b4332;">15ÂÄã</div>
                                <div class="text-xs" style="color:#737373;">Â≠¶Áøí„Åó„ÅüÁî®Ë™û</div>
                            </div>
                            <div class="text-center p-2 rounded-lg" style="background:#f8faf8;">
                                <div class="text-base mb-0.5">‚öñÔ∏è</div>
                                <div class="text-sm font-bold" style="color:#1b4332;">6Âõû</div>
                                <div class="text-xs" style="color:#737373;">ÊØîËºÉ„Åó„ÅüÂõûÊï∞</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function mypageApp() {
    return {
        noteSearch: '',
        noteSort: 'date',
        activeTag: '',
        notes: [
            {
                name: '„Ç≠„Éº„Ç®„É≥„Çπ', code: '6861', stars: 5, date: '01/15',
                sortDate: 20250115,
                summary: 'Âñ∂Ê•≠Âà©ÁõäÁéá50%Ë∂Ö„ÅØÂõΩÂÜÖË£ΩÈÄ†Ê•≠„Åß„ÇÇÁï∞Ê¨°ÂÖÉ„ÄÇ„Éï„Ç°„Éñ„É¨„Çπ„É¢„Éá„É´„Å®Áõ¥Ë≤©‰ΩìÂà∂„ÅåÁ´∂‰∫âÂÑ™‰Ωç„ÅÆÊ∫êÊ≥â„ÄÇ',
                tags: ['È´òÂèéÁõä', 'IoT', '„Éï„Ç°„Éñ„É¨„Çπ']
            },
            {
                name: '‰ªªÂ§©Â†Ç', code: '7974', stars: 4, date: '01/10',
                sortDate: 20250110,
                summary: 'IPÔºàÁü•ÁöÑË≤°Áî£Ôºâ„ÅÆÂäõ„ÅåÂúßÂÄíÁöÑ„ÄÇ„Éè„Éº„ÉâÔºã„ÇΩ„Éï„ÉàÔºãÊò†Áîª„ÅÆÂûÇÁõ¥Áµ±Âêà„ÄÇÁèæÈáë‰øùÊúâÈáè„ÅåÁï∞Â∏∏„Å´Â§ö„ÅÑ„ÄÇ',
                tags: ['IPÁµåÂñ∂', '„Ç®„É≥„Çø„É°', 'È´òËá™Â∑±Ë≥áÊú¨']
            },
            {
                name: '‰ø°Ë∂äÂåñÂ≠¶Â∑•Ê•≠', code: '4063', stars: 4, date: '12/28',
                sortDate: 20241228,
                summary: 'Â°©„Éì„Å®„Ç∑„É™„Ç≥„É≥„Ç¶„Çß„Éè„Éº„Åß‰∏ñÁïå„Éà„ÉÉ„Éó„Ç∑„Çß„Ç¢„ÄÇÂú∞Âë≥„Å†„ÅåÁùÄÂÆü„Å´Âà©Áõä„ÇíÁ©ç„ÇÄ„ÄåÈùô„Åã„Å™Â∑®‰∫∫„Äç„ÄÇ',
                tags: ['Á¥†Êùê', '‰∏ñÁïå„Ç∑„Çß„Ç¢', 'ÂçäÂ∞é‰Ωì']
            }
        ],
        get allTags() {
            const tags = new Set();
            this.notes.forEach(n => n.tags.forEach(t => tags.add(t)));
            return [...tags];
        },
        get filteredNotes() {
            let result = [...this.notes];
            // Ê§úÁ¥¢„Éï„Ç£„É´„Çø
            if (this.noteSearch) {
                const q = this.noteSearch.toLowerCase();
                result = result.filter(n =>
                    n.name.toLowerCase().includes(q) ||
                    n.code.includes(q) ||
                    n.summary.toLowerCase().includes(q) ||
                    n.tags.some(t => t.toLowerCase().includes(q))
                );
            }
            // „Çø„Ç∞„Éï„Ç£„É´„Çø
            if (this.activeTag) {
                result = result.filter(n => n.tags.includes(this.activeTag));
            }
            // „ÇΩ„Éº„Éà
            if (this.noteSort === 'star') {
                result.sort((a, b) => b.stars - a.stars);
            } else {
                result.sort((a, b) => b.sortDate - a.sortDate);
            }
            return result;
        }
    };
}
</script>
{% endblock %}
